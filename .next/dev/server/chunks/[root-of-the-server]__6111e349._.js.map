{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///E:/New%20folder%20%282%29/testing2/testing2/lib/scraper/upworkScraper.js"],"sourcesContent":["import puppeteer from 'puppeteer';\nimport { randomUUID } from 'crypto';\n\nlet browser = null;\nlet isAuthenticated = false;\n\n// Get random number for mouse movements\nfunction getRndm(min, max) {\n  return Math.floor(Math.random() * (max - min + 1)) + min;\n}\n\n// Random delay to mimic human behavior (longer delays)\nfunction randomDelay(min = 2000, max = 5000) {\n  return new Promise(resolve => setTimeout(resolve, Math.random() * (max - min) + min));\n}\n\n// Generate random viewport size\nfunction getRandomViewport() {\n  const viewports = [\n    { width: 1920, height: 1080 },\n    { width: 1366, height: 768 },\n    { width: 1536, height: 864 },\n    { width: 1440, height: 900 },\n  ];\n  return viewports[Math.floor(Math.random() * viewports.length)];\n}\n\n// Get random user agent (updated to latest versions)\nfunction getRandomUserAgent() {\n  const userAgents = [\n    'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36',\n    'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36',\n    'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36',\n    'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:132.0) Gecko/20100101 Firefox/132.0',\n  ];\n  return userAgents[Math.floor(Math.random() * userAgents.length)];\n}\n\nasync function getBrowser() {\n  if (!browser) {\n    console.log('[Scraper] Launching Puppeteer browser with stealth mode...');\n    browser = await puppeteer.launch({\n      headless: false, // Set to false for better success rate\n      args: [\n        '--no-sandbox',\n        '--disable-setuid-sandbox',\n        '--disable-dev-shm-usage',\n        '--disable-blink-features=AutomationControlled',\n        '--disable-features=IsolateOrigins,site-per-process',\n        '--window-size=1920,1080',\n        '--lang=en-US,en',\n      ],\n    });\n    console.log('[Scraper] Browser launched successfully');\n  }\n  return browser;\n}\n\nexport async function closeBrowser() {\n  if (browser) {\n    await browser.close();\n    browser = null;\n    isAuthenticated = false;\n  }\n}\n\n// Login to Upwork (CRITICAL: This significantly improves scraping success)\nasync function loginToUpwork(page, email, password) {\n  if (isAuthenticated) {\n    console.log('[Scraper] Already authenticated');\n    return;\n  }\n\n  if (!email || !password) {\n    console.log('[Scraper] No credentials provided, skipping authentication');\n    return;\n  }\n\n  try {\n    console.log('[Scraper] Logging into Upwork...');\n    \n    await page.goto('https://www.upwork.com/ab/account-security/login', {\n      waitUntil: 'networkidle2',\n      timeout: 60000,\n    });\n\n    await randomDelay(2000, 4000);\n\n    // Enter email\n    await page.waitForSelector('#login_username', { visible: true, timeout: 10000 });\n    await page.type('#login_username', email, { delay: getRndm(50, 150) });\n    \n    await randomDelay(1000, 2000);\n\n    // Click continue with email\n    await page.click('#login_password_continue');\n    \n    await randomDelay(2000, 3000);\n\n    // Random mouse movements (human-like behavior)\n    for (let i = 0; i < 5; i++) {\n      await page.mouse.move(getRndm(100, 1000), getRndm(100, 800));\n      await randomDelay(500, 1000);\n    }\n\n    // Enter password\n    await page.waitForSelector('#login_password', { visible: true, timeout: 10000 });\n    await page.type('#login_password', password, { delay: getRndm(50, 150) });\n    \n    await randomDelay(1000, 2000);\n\n    // Click login\n    await page.click('#login_control_continue');\n\n    // More random mouse movements\n    for (let i = 0; i < 5; i++) {\n      await page.mouse.move(getRndm(100, 1500), getRndm(100, 900));\n      await randomDelay(800, 1500);\n    }\n\n    // Wait for navigation to complete\n    await randomDelay(5000, 8000);\n\n    isAuthenticated = true;\n    console.log('[Scraper] Successfully authenticated');\n  } catch (error) {\n    console.error('[Scraper] Login failed:', error.message);\n    throw new Error('Authentication required but failed');\n  }\n}\n\nfunction buildFullJobUrl(rawUrl) {\n  if (!rawUrl) return '';\n  \n  if (rawUrl.startsWith('http://') || rawUrl.startsWith('https://')) {\n    return rawUrl;\n  }\n  \n  if (rawUrl.startsWith('/')) {\n    return `https://www.upwork.com${rawUrl}`;\n  }\n  \n  return `https://www.upwork.com/${rawUrl}`;\n}\n\nexport async function scrapeUpworkJobs(options) {\n  const { url, limit, sortBy, credentials } = options;\n  const jobs = [];\n  let page = null;\n\n  try {\n    const browserInstance = await getBrowser();\n    page = await browserInstance.newPage();\n\n    // Set random viewport\n    const viewport = getRandomViewport();\n    await page.setViewport(viewport);\n\n    // Set random user agent\n    const userAgent = getRandomUserAgent();\n    await page.setUserAgent(userAgent);\n\n    // Remove webdriver detection\n    await page.evaluateOnNewDocument(() => {\n      // Remove webdriver flag\n      Object.defineProperty(navigator, 'webdriver', {\n        get: () => false,\n      });\n      \n      // Add chrome object\n      window.chrome = {\n        runtime: {},\n      };\n\n      // Mock permissions\n      const originalQuery = window.navigator.permissions.query;\n      window.navigator.permissions.query = (parameters) => (\n        parameters.name === 'notifications'\n          ? Promise.resolve({ state: Notification.permission })\n          : originalQuery(parameters)\n      );\n\n      // Mock plugins\n      Object.defineProperty(navigator, 'plugins', {\n        get: () => [1, 2, 3, 4, 5],\n      });\n\n      // Mock languages\n      Object.defineProperty(navigator, 'languages', {\n        get: () => ['en-US', 'en'],\n      });\n\n      // Mock platform\n      Object.defineProperty(navigator, 'platform', {\n        get: () => 'Win32',\n      });\n    });\n\n    // Set realistic headers\n    await page.setExtraHTTPHeaders({\n      'Accept-Language': 'en-US,en;q=0.9',\n      'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8',\n      'Accept-Encoding': 'gzip, deflate, br',\n      'sec-ch-ua': '\"Google Chrome\";v=\"131\", \"Chromium\";v=\"131\", \"Not_A Brand\";v=\"24\"',\n      'sec-ch-ua-mobile': '?0',\n      'sec-ch-ua-platform': '\"Windows\"',\n      'sec-fetch-dest': 'document',\n      'sec-fetch-mode': 'navigate',\n      'sec-fetch-site': 'none',\n      'sec-fetch-user': '?1',\n      'upgrade-insecure-requests': '1',\n    });\n\n    // CRITICAL: Login to Upwork first (improves success rate significantly)\n    if (credentials?.email && credentials?.password) {\n      await loginToUpwork(page, credentials.email, credentials.password);\n    } else {\n      console.log('[Scraper] WARNING: No credentials provided. Scraping without authentication may have limited success.');\n    }\n\n    console.log(`[Scraper] Navigating to: ${url}`);\n\n    // Add random delay before navigation (rate limiting)\n    await randomDelay(3000, 6000);\n\n    let navigationSuccess = false;\n    let retries = 3;\n\n    while (retries > 0 && !navigationSuccess) {\n      try {\n        await page.goto(url, {\n          waitUntil: 'networkidle2',\n          timeout: 60000,\n        });\n        navigationSuccess = true;\n      } catch (navError) {\n        retries--;\n        console.log(`[Scraper] Navigation attempt failed, ${retries} retries left`);\n        if (retries === 0) throw navError;\n        await randomDelay(5000, 10000); // Longer delay between retries\n      }\n    }\n\n    // Longer wait for page to fully load\n    await randomDelay(4000, 7000);\n\n    // Simulate human mouse movements\n    for (let i = 0; i < 8; i++) {\n      await page.mouse.move(getRndm(100, 1500), getRndm(100, 900));\n      await randomDelay(300, 800);\n    }\n\n    console.log('[Scraper] Waiting for job listings to load...');\n\n    const possibleSelectors = [\n      'section[data-test=\"JobTile\"]',\n      '[data-test=\"JobTile\"]',\n      '.job-tile',\n      'article[data-ev-label]',\n      'section.air3-card-section',\n      '[data-test=\"job-tile-list\"]',\n      '.up-card-section',\n    ];\n\n    let foundSelector = null;\n    for (const selector of possibleSelectors) {\n      try {\n        await page.waitForSelector(selector, { timeout: 15000 });\n        foundSelector = selector;\n        console.log(`[Scraper] Found jobs using selector: ${selector}`);\n        break;\n      } catch {\n        // Try next selector\n      }\n    }\n\n    if (!foundSelector) {\n      console.log('[Scraper] No job selectors found - possible blocking or empty results');\n      // Take screenshot for debugging\n      await page.screenshot({ path: 'debug-screenshot.png' });\n      throw new Error('Could not find job listings. Possible bot detection or no results.');\n    }\n\n    // Random delay before scrolling\n    await randomDelay(2000, 4000);\n\n    // Scroll to load more jobs (if needed) - smaller batches\n    if (limit > 10) {\n      console.log('[Scraper] Scrolling to load more jobs...');\n      const scrolls = Math.min(Math.ceil(limit / 10), 3); // Max 3 scrolls (smaller batches)\n      await humanLikeScroll(page, scrolls);\n    }\n\n    // Another delay before extraction\n    await randomDelay(3000, 5000);\n\n    console.log('[Scraper] Extracting job data...');\n    const extractedJobs = await page.evaluate(() => {\n      const jobElements = document.querySelectorAll(\n        'section[data-test=\"JobTile\"], [data-test=\"JobTile\"], .job-tile, article[data-ev-label=\"search_results_impression\"], section.air3-card-section, .up-card-section'\n      );\n\n      console.log(`Found ${jobElements.length} job elements`);\n\n      const jobs = [];\n\n      jobElements.forEach((element) => {\n        try {\n          const titleElement =\n            element.querySelector('[data-test=\"job-title-link\"]') ||\n            element.querySelector('[data-test=\"JobTile-link\"]') ||\n            element.querySelector('h2 a, h3 a, h4 a') ||\n            element.querySelector('.job-tile-title a') ||\n            element.querySelector('.job-title a') ||\n            element.querySelector('a[href*=\"/jobs/\"]');\n\n          const title = titleElement?.textContent?.trim() || '';\n          const jobUrl = titleElement?.getAttribute('href') || '';\n\n          if (!title) return;\n\n          const descriptionElement =\n            element.querySelector('[data-test=\"JobDescription\"]') ||\n            element.querySelector('[data-test=\"job-description-text\"]') ||\n            element.querySelector('.job-description') ||\n            element.querySelector('.air3-truncation') ||\n            element.querySelector('[data-test=\"UpCLineClamp\"]') ||\n            element.querySelector('p');\n\n          const description = descriptionElement?.textContent?.trim() || '';\n\n          const budgetElement =\n            element.querySelector('[data-test=\"budget\"]') ||\n            element.querySelector('[data-test=\"is-fixed-price\"]') ||\n            element.querySelector('.job-budget') ||\n            element.querySelector('[data-test=\"JobBudget\"]') ||\n            element.querySelector('[data-qa=\"job-budget\"]');\n\n          const budget = budgetElement?.textContent?.trim() || '';\n\n          const hourlyRateElement =\n            element.querySelector('[data-test=\"hourly-rate\"]') ||\n            element.querySelector('[data-qa=\"hourly-rate\"]') ||\n            element.querySelector('.job-hourly-rate');\n\n          const hourlyRate = hourlyRateElement?.textContent?.trim() || '';\n\n          const postedElement =\n            element.querySelector('[data-test=\"posted-on\"]') ||\n            element.querySelector('[data-test=\"job-pubdate\"]') ||\n            element.querySelector('.job-posted-date') ||\n            element.querySelector('time') ||\n            element.querySelector('[data-qa=\"job-posted-on\"]') ||\n            element.querySelector('small');\n\n          const postedDate = postedElement?.textContent?.trim() || 'Recently';\n\n          const skillElements = element.querySelectorAll(\n            '[data-test=\"Skill\"], [data-test=\"token\"] span, .air3-token, .skill-badge, .up-skill-badge'\n          );\n          const skills = [];\n          skillElements.forEach((skill) => {\n            const text = skill.textContent?.trim();\n            if (text && text.length < 50 && text.length > 1) {\n              skills.push(text);\n            }\n          });\n\n          const clientElement =\n            element.querySelector('[data-test=\"client-company-name\"]') ||\n            element.querySelector('.client-name') ||\n            element.querySelector('[data-qa=\"client-company-name\"]');\n          const clientName = clientElement?.textContent?.trim() || '';\n\n          const locationElement =\n            element.querySelector('[data-test=\"client-location\"]') ||\n            element.querySelector('[data-qa=\"client-location\"]') ||\n            element.querySelector('.client-location');\n          const clientCountry = locationElement?.textContent?.trim() || '';\n\n          const verifiedElement = element.querySelector(\n            '[data-test=\"payment-verified\"], .payment-verified, [data-qa=\"payment-verified\"]'\n          );\n          const clientVerified = !!verifiedElement;\n\n          const expElement =\n            element.querySelector('[data-test=\"experience-level\"]') ||\n            element.querySelector('[data-qa=\"experience-level\"]') ||\n            element.querySelector('.experience-level');\n          const experienceLevel = expElement?.textContent?.trim() || '';\n\n          const typeElement =\n            element.querySelector('[data-test=\"job-type\"]') ||\n            element.querySelector('[data-qa=\"job-type\"]');\n          const jobType = typeElement?.textContent?.trim() || '';\n\n          const durationElement =\n            element.querySelector('[data-test=\"duration\"]') ||\n            element.querySelector('[data-qa=\"duration\"]');\n          const duration = durationElement?.textContent?.trim() || '';\n\n          jobs.push({\n            title,\n            description,\n            budget,\n            hourlyRate,\n            clientName,\n            clientCountry,\n            clientVerified,\n            postedDate,\n            skills,\n            jobType,\n            experienceLevel,\n            duration,\n            rawUrl: jobUrl,\n          });\n        } catch (err) {\n          // Skip problematic elements\n        }\n      });\n\n      return jobs;\n    });\n\n    console.log(`[Scraper] Extracted ${extractedJobs.length} jobs from page`);\n\n    const limitedJobs = limit === 0 ? extractedJobs : extractedJobs.slice(0, limit);\n\n    for (const job of limitedJobs) {\n      const fullUrl = buildFullJobUrl(job.rawUrl);\n\n      jobs.push({\n        id: randomUUID(),\n        title: job.title,\n        description: job.description,\n        budget: job.budget || undefined,\n        hourlyRate: job.hourlyRate || undefined,\n        clientName: job.clientName || undefined,\n        clientCountry: job.clientCountry || undefined,\n        clientVerified: job.clientVerified,\n        postedDate: job.postedDate,\n        skills: job.skills,\n        jobType: job.jobType || undefined,\n        experienceLevel: job.experienceLevel || undefined,\n        duration: job.duration || undefined,\n        url: fullUrl,\n      });\n    }\n\n    if (sortBy === 'budget') {\n      jobs.sort((a, b) => {\n        const budgetA = parseFloat((a.budget || '0').replace(/[^0-9.]/g, '')) || 0;\n        const budgetB = parseFloat((b.budget || '0').replace(/[^0-9.]/g, '')) || 0;\n        return budgetB - budgetA;\n      });\n    } else if (sortBy === 'date') {\n      const dateOrder = {\n        'Just now': 0,\n        '1 minute ago': 1,\n        '5 minutes ago': 2,\n        '10 minutes ago': 3,\n        '1 hour ago': 4,\n        '2 hours ago': 5,\n        '3 hours ago': 6,\n        'Today': 7,\n        'Yesterday': 8,\n        '2 days ago': 9,\n        '3 days ago': 10,\n        'Recently': 11,\n      };\n      \n      jobs.sort((a, b) => {\n        const orderA = dateOrder[a.postedDate] ?? 99;\n        const orderB = dateOrder[b.postedDate] ?? 99;\n        return orderA - orderB;\n      });\n    }\n\n    console.log(`[Scraper] Successfully processed ${jobs.length} jobs`);\n    return jobs;\n  } catch (error) {\n    console.error('[Scraper] Error scraping jobs:', error);\n    throw error;\n  } finally {\n    if (page) {\n      await page.close().catch(() => {});\n    }\n  }\n}\n\n// Human-like scrolling with random delays\nasync function humanLikeScroll(page, maxScrolls = 3) {\n  await page.evaluate(async (maxScrolls) => {\n    await new Promise((resolve) => {\n      let scrollCount = 0;\n      const distance = 300; // Smaller scrolls\n      const timer = setInterval(() => {\n        window.scrollBy(0, distance);\n        scrollCount++;\n\n        if (scrollCount >= maxScrolls * 3) {\n          clearInterval(timer);\n          resolve();\n        }\n      }, Math.random() * 1000 + 1000); // 1-2 second delays\n    });\n  }, maxScrolls);\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 493, "column": 0}, "map": {"version":3,"sources":["file:///E:/New%20folder%20%282%29/testing2/testing2/lib/storage.js"],"sourcesContent":["let jobs = [];\n\nexport function getJobs() {\n  return jobs;\n}\n\nexport function getJobById(id) {\n  return jobs.find(job => job.id === id);\n}\n\nexport function setJobs(newJobs) {\n  jobs = newJobs;\n}\n\nexport function addJobs(newJobs) {\n  jobs = [...jobs, ...newJobs];\n}\n\nexport function clearJobs() {\n  jobs = [];\n}\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA,IAAI,OAAO,EAAE;AAEN,SAAS;IACd,OAAO;AACT;AAEO,SAAS,WAAW,EAAE;IAC3B,OAAO,KAAK,IAAI,CAAC,CAAA,MAAO,IAAI,EAAE,KAAK;AACrC;AAEO,SAAS,QAAQ,OAAO;IAC7B,OAAO;AACT;AAEO,SAAS,QAAQ,OAAO;IAC7B,OAAO;WAAI;WAAS;KAAQ;AAC9B;AAEO,SAAS;IACd,OAAO,EAAE;AACX"}},
    {"offset": {"line": 528, "column": 0}, "map": {"version":3,"sources":["file:///E:/New%20folder%20%282%29/testing2/testing2/lib/schema.js"],"sourcesContent":["import { z } from 'zod';\n\n// Schema for scraping Upwork jobs request validation\nexport const scrapeRequestSchema = z.object({\n  url: z.string().url('Invalid URL format'),\n  limit: z.number().int().min(0).max(100).default(10),\n  sortBy: z.enum(['recent', 'budget', 'date']).default('recent'),\n  useMockData: z.boolean().optional().default(false),\n  credentials: z.object({\n    email: z.string().email().optional(),\n    password: z.string().optional(),\n  }).optional(),\n});\n\n// Schema for individual job data\nexport const jobSchema = z.object({\n  id: z.string(),\n  title: z.string(),\n  description: z.string(),\n  budget: z.string().optional(),\n  hourlyRate: z.string().optional(),\n  clientName: z.string().optional(),\n  clientCountry: z.string().optional(),\n  clientVerified: z.boolean(),\n  postedDate: z.string(),\n  skills: z.array(z.string()),\n  jobType: z.string().optional(),\n  experienceLevel: z.string().optional(),\n  duration: z.string().optional(),\n  url: z.string(),\n});\n\n// Schema for scraping response\nexport const scrapeResponseSchema = z.object({\n  success: z.boolean(),\n  jobs: z.array(jobSchema),\n  count: z.number(),\n  message: z.string().optional(),\n});\n\n// Schema for error response\nexport const errorResponseSchema = z.object({\n  success: z.boolean(),\n  error: z.string(),\n  details: z.any().optional(),\n});"],"names":[],"mappings":";;;;;;;;;;AAAA;;AAGO,MAAM,sBAAsB,yKAAC,CAAC,MAAM,CAAC;IAC1C,KAAK,yKAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACpB,OAAO,yKAAC,CAAC,MAAM,GAAG,GAAG,GAAG,GAAG,CAAC,GAAG,GAAG,CAAC,KAAK,OAAO,CAAC;IAChD,QAAQ,yKAAC,CAAC,IAAI,CAAC;QAAC;QAAU;QAAU;KAAO,EAAE,OAAO,CAAC;IACrD,aAAa,yKAAC,CAAC,OAAO,GAAG,QAAQ,GAAG,OAAO,CAAC;IAC5C,aAAa,yKAAC,CAAC,MAAM,CAAC;QACpB,OAAO,yKAAC,CAAC,MAAM,GAAG,KAAK,GAAG,QAAQ;QAClC,UAAU,yKAAC,CAAC,MAAM,GAAG,QAAQ;IAC/B,GAAG,QAAQ;AACb;AAGO,MAAM,YAAY,yKAAC,CAAC,MAAM,CAAC;IAChC,IAAI,yKAAC,CAAC,MAAM;IACZ,OAAO,yKAAC,CAAC,MAAM;IACf,aAAa,yKAAC,CAAC,MAAM;IACrB,QAAQ,yKAAC,CAAC,MAAM,GAAG,QAAQ;IAC3B,YAAY,yKAAC,CAAC,MAAM,GAAG,QAAQ;IAC/B,YAAY,yKAAC,CAAC,MAAM,GAAG,QAAQ;IAC/B,eAAe,yKAAC,CAAC,MAAM,GAAG,QAAQ;IAClC,gBAAgB,yKAAC,CAAC,OAAO;IACzB,YAAY,yKAAC,CAAC,MAAM;IACpB,QAAQ,yKAAC,CAAC,KAAK,CAAC,yKAAC,CAAC,MAAM;IACxB,SAAS,yKAAC,CAAC,MAAM,GAAG,QAAQ;IAC5B,iBAAiB,yKAAC,CAAC,MAAM,GAAG,QAAQ;IACpC,UAAU,yKAAC,CAAC,MAAM,GAAG,QAAQ;IAC7B,KAAK,yKAAC,CAAC,MAAM;AACf;AAGO,MAAM,uBAAuB,yKAAC,CAAC,MAAM,CAAC;IAC3C,SAAS,yKAAC,CAAC,OAAO;IAClB,MAAM,yKAAC,CAAC,KAAK,CAAC;IACd,OAAO,yKAAC,CAAC,MAAM;IACf,SAAS,yKAAC,CAAC,MAAM,GAAG,QAAQ;AAC9B;AAGO,MAAM,sBAAsB,yKAAC,CAAC,MAAM,CAAC;IAC1C,SAAS,yKAAC,CAAC,OAAO;IAClB,OAAO,yKAAC,CAAC,MAAM;IACf,SAAS,yKAAC,CAAC,GAAG,GAAG,QAAQ;AAC3B"}},
    {"offset": {"line": 587, "column": 0}, "map": {"version":3,"sources":["file:///E:/New%20folder%20%282%29/testing2/testing2/app/api/scrape/route.js"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { scrapeUpworkJobs } from '../../../lib/scraper/upworkScraper.js';\nimport { setJobs, getJobs } from '../../../lib/storage.js';\nimport { scrapeRequestSchema } from '../../../lib/schema.js';\n\nexport async function POST(request) {\n  try {\n    const body = await request.json();\n    const validatedData = scrapeRequestSchema.parse(body);\n    const { url, limit, sortBy, credentials } = validatedData;\n\n    console.log(`[API] Scrape request: ${url}, limit: ${limit}, sortBy: ${sortBy}`);\n\n    let jobs = [];\n    let status = 'success';\n    let message = undefined;\n\n    try {\n      // Pass credentials to scraper if provided\n      jobs = await scrapeUpworkJobs({ \n        url, \n        limit, \n        sortBy,\n        credentials: credentials || {\n          email: process.env.UPWORK_EMAIL,\n          password: process.env.UPWORK_PASSWORD\n        }\n      });\n\n      if (jobs.length === 0) {\n        console.log('[API] No jobs found');\n        status = 'partial';\n        message = 'No jobs found on the page. This could be due to no matching results or the search query returning empty results.';\n      }\n    } catch (scrapeError) {\n      console.error('[API] Scrape error:', scrapeError.message);\n      status = 'error';\n      message = `Scraping failed: ${scrapeError.message}`;\n      \n      return NextResponse.json(\n        { \n          error: message,\n          jobs: [],\n          totalFound: 0,\n          scrapedCount: 0,\n          status \n        },\n        { status: 500 }\n      );\n    }\n\n    setJobs(jobs);\n\n    return NextResponse.json({\n      jobs,\n      totalFound: jobs.length,\n      scrapedCount: jobs.length,\n      status,\n      message,\n    });\n  } catch (error) {\n    console.error('[API] Error:', error);\n    return NextResponse.json(\n      { error: error.message || 'Failed to scrape jobs' },\n      { status: 400 }\n    );\n  }\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;;;;;AAEO,eAAe,KAAK,OAAO;IAChC,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,gBAAgB,sIAAmB,CAAC,KAAK,CAAC;QAChD,MAAM,EAAE,GAAG,EAAE,KAAK,EAAE,MAAM,EAAE,WAAW,EAAE,GAAG;QAE5C,QAAQ,GAAG,CAAC,CAAC,sBAAsB,EAAE,IAAI,SAAS,EAAE,MAAM,UAAU,EAAE,QAAQ;QAE9E,IAAI,OAAO,EAAE;QACb,IAAI,SAAS;QACb,IAAI,UAAU;QAEd,IAAI;YACF,0CAA0C;YAC1C,OAAO,MAAM,IAAA,qJAAgB,EAAC;gBAC5B;gBACA;gBACA;gBACA,aAAa,eAAe;oBAC1B,OAAO,QAAQ,GAAG,CAAC,YAAY;oBAC/B,UAAU,QAAQ,GAAG,CAAC,eAAe;gBACvC;YACF;YAEA,IAAI,KAAK,MAAM,KAAK,GAAG;gBACrB,QAAQ,GAAG,CAAC;gBACZ,SAAS;gBACT,UAAU;YACZ;QACF,EAAE,OAAO,aAAa;YACpB,QAAQ,KAAK,CAAC,uBAAuB,YAAY,OAAO;YACxD,SAAS;YACT,UAAU,CAAC,iBAAiB,EAAE,YAAY,OAAO,EAAE;YAEnD,OAAO,gJAAY,CAAC,IAAI,CACtB;gBACE,OAAO;gBACP,MAAM,EAAE;gBACR,YAAY;gBACZ,cAAc;gBACd;YACF,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,IAAA,2HAAO,EAAC;QAER,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB;YACA,YAAY,KAAK,MAAM;YACvB,cAAc,KAAK,MAAM;YACzB;YACA;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gBAAgB;QAC9B,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO,MAAM,OAAO,IAAI;QAAwB,GAClD;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}